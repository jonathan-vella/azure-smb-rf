{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.40.2.10011",
      "templateHash": "6450441083269115785"
    }
  },
  "parameters": {
    "location": {
      "type": "string",
      "metadata": {
        "description": "Azure region for resource group deployment"
      }
    },
    "environment": {
      "type": "string",
      "allowedValues": [
        "dev",
        "staging",
        "prod"
      ],
      "metadata": {
        "description": "Environment name for spoke resources"
      }
    },
    "regionShort": {
      "type": "string",
      "metadata": {
        "description": "Region abbreviation for naming"
      }
    },
    "sharedServicesTags": {
      "type": "object",
      "metadata": {
        "description": "Tags for shared services resource groups (Environment = smb)"
      }
    },
    "spokeTags": {
      "type": "object",
      "metadata": {
        "description": "Tags for spoke resource group (Environment = dev/staging/prod)"
      }
    }
  },
  "resources": [
    {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2024-03-01",
      "name": "[format('rg-hub-smb-{0}', parameters('regionShort'))]",
      "location": "[parameters('location')]",
      "tags": "[parameters('sharedServicesTags')]",
      "metadata": {
        "description": "Hub resource group - VNet, Bastion, Firewall, VPN Gateway"
      }
    },
    {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2024-03-01",
      "name": "[format('rg-monitor-smb-{0}', parameters('regionShort'))]",
      "location": "[parameters('location')]",
      "tags": "[parameters('sharedServicesTags')]",
      "metadata": {
        "description": "Monitoring resource group - Log Analytics"
      }
    },
    {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2024-03-01",
      "name": "[format('rg-backup-smb-{0}', parameters('regionShort'))]",
      "location": "[parameters('location')]",
      "tags": "[parameters('sharedServicesTags')]",
      "metadata": {
        "description": "Backup resource group - Recovery Services Vault"
      }
    },
    {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2024-03-01",
      "name": "[format('rg-migrate-smb-{0}', parameters('regionShort'))]",
      "location": "[parameters('location')]",
      "tags": "[parameters('sharedServicesTags')]",
      "metadata": {
        "description": "Migration resource group - Azure Migrate Project"
      }
    },
    {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2024-03-01",
      "name": "[format('rg-spoke-{0}-{1}', parameters('environment'), parameters('regionShort'))]",
      "location": "[parameters('location')]",
      "tags": "[parameters('spokeTags')]",
      "metadata": {
        "description": "Spoke resource group - Workload VNet, NAT Gateway"
      }
    }
  ],
  "outputs": {
    "hubResourceGroupName": {
      "type": "string",
      "metadata": {
        "description": "Hub resource group name"
      },
      "value": "[format('rg-hub-smb-{0}', parameters('regionShort'))]"
    },
    "hubResourceGroupId": {
      "type": "string",
      "metadata": {
        "description": "Hub resource group ID"
      },
      "value": "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-hub-smb-{0}', parameters('regionShort')))]"
    },
    "spokeResourceGroupName": {
      "type": "string",
      "metadata": {
        "description": "Spoke resource group name"
      },
      "value": "[format('rg-spoke-{0}-{1}', parameters('environment'), parameters('regionShort'))]"
    },
    "spokeResourceGroupId": {
      "type": "string",
      "metadata": {
        "description": "Spoke resource group ID"
      },
      "value": "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-spoke-{0}-{1}', parameters('environment'), parameters('regionShort')))]"
    },
    "monitorResourceGroupName": {
      "type": "string",
      "metadata": {
        "description": "Monitor resource group name"
      },
      "value": "[format('rg-monitor-smb-{0}', parameters('regionShort'))]"
    },
    "monitorResourceGroupId": {
      "type": "string",
      "metadata": {
        "description": "Monitor resource group ID"
      },
      "value": "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-monitor-smb-{0}', parameters('regionShort')))]"
    },
    "backupResourceGroupName": {
      "type": "string",
      "metadata": {
        "description": "Backup resource group name"
      },
      "value": "[format('rg-backup-smb-{0}', parameters('regionShort'))]"
    },
    "backupResourceGroupId": {
      "type": "string",
      "metadata": {
        "description": "Backup resource group ID"
      },
      "value": "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-backup-smb-{0}', parameters('regionShort')))]"
    },
    "migrateResourceGroupName": {
      "type": "string",
      "metadata": {
        "description": "Migrate resource group name"
      },
      "value": "[format('rg-migrate-smb-{0}', parameters('regionShort'))]"
    },
    "migrateResourceGroupId": {
      "type": "string",
      "metadata": {
        "description": "Migrate resource group ID"
      },
      "value": "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-migrate-smb-{0}', parameters('regionShort')))]"
    }
  }
}