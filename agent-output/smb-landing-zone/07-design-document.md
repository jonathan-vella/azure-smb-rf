# Azure Design Document: SMB Landing Zone

> Generated by docs agent | 2026-02-02 | Artifact v0.1
> **Status**: Complete

---

## 1. Introduction

### 1.1 Document Purpose

This design document provides comprehensive technical documentation for the SMB Landing Zone
Azure infrastructure. It serves as a reference for operations teams, auditors, and future
development efforts.

**Intended Audience:**

- Solution Architects
- Operations/SRE Teams
- Security & Compliance Teams
- Microsoft Partners

### 1.2 Project Overview

The SMB Landing Zone is a repeatable Azure infrastructure pattern designed for Microsoft Partners
hosting 1000+ small business customers migrating from on-premises VMware environments. It provides
a cost-optimized, policy-enforced, CAF-aligned foundation for workload migrations.

**Business Objectives:**

- Provide repeatable infrastructure for SMB customer onboarding
- Minimize Azure costs while maintaining security baseline
- Enable on-premises to Azure migrations via Azure Migrate
- Enforce governance through Azure Policy guardrails

### 1.3 Design Objectives

| Objective    | Target                      | Implementation                        |
| ------------ | --------------------------- | ------------------------------------- |
| Availability | Best-effort (no SLA)        | Single-region, no zone redundancy     |
| Performance  | Standard workloads          | B/D/E-series VMs, Standard storage    |
| Security     | Azure Security Baseline     | 21 Azure Policies, NSG deny-all       |
| Scalability  | Per-customer isolation      | Hub-spoke per customer subscription   |

### 1.4 Constraints & Assumptions

**Constraints:**

- Single subscription per customer (not multi-subscription landing zone)
- No high availability requirements (cost optimization priority)
- Limited to B, D, and E series VMs (policy enforced)
- EU GDPR compliance required (swedencentral region)

**Assumptions:**

- Customers have existing on-premises VMware infrastructure
- Azure Migrate will be used for server discovery and migration
- Partners manage Azure environment on behalf of customers
- VPN connectivity to on-premises may or may not be required

### 1.5 Stakeholders

| Role                    | Team                | Responsibility                    |
| ----------------------- | ------------------- | --------------------------------- |
| Cloud Architect         | Partner Team        | Design approval, WAF alignment    |
| Operations Engineer     | Partner Team        | Day-2 operations, monitoring      |
| Security Officer        | Partner/Customer    | Compliance validation             |
| Project Manager         | Partner Team        | Deployment coordination           |

---

## 2. Azure Architecture Overview

### 2.1 Architecture Diagram

```text
                    ┌──────────────────────────────────────────────────┐
                    │                  Azure Subscription               │
                    │                    (per customer)                 │
                    └──────────────────────────────────────────────────┘
                                           │
        ┌──────────────────────────────────┼──────────────────────────────────┐
        │                                  │                                  │
        ▼                                  ▼                                  ▼
┌───────────────┐                 ┌───────────────┐                  ┌───────────────┐
│   rg-hub      │                 │  rg-spoke     │                  │  rg-monitor   │
│               │                 │               │                  │               │
│ • Hub VNet    │◄── Peering ────►│ • Spoke VNet  │                  │ • Log Analy.  │
│ • Firewall*   │                 │ • NAT GW**    │                  │ • Defender    │
│ • VPN GW*     │                 │ • NSG         │                  └───────────────┘
│ • Bastion     │                 │ • Workloads   │
│ • Private DNS │                 └───────────────┘
└───────────────┘
        │
        ▼ (if VPN deployed)
┌───────────────┐
│  On-Premises  │
│   Network     │
└───────────────┘

* Firewall: Deployed in firewall/full scenarios
** NAT GW: Deployed in baseline scenario only
```

### 2.2 Resource Summary

| Category   | Count | Resources                                        |
| ---------- | ----- | ------------------------------------------------ |
| Compute    | 0     | None deployed (customer adds workloads)          |
| Networking | 15    | VNets, Subnets, NSGs, Firewall, VPN, NAT, Routes |
| Data       | 0     | None deployed (customer adds workloads)          |
| Security   | 21    | Azure Policy assignments                         |
| Monitoring | 2     | Log Analytics, Budget alerts                     |
| Backup     | 2     | Recovery Services Vault, Azure Migrate           |

---

## 3. Networking

### 3.1 Network Topology

The landing zone uses a **hub-and-spoke** topology within a single subscription:

| VNet | Purpose | Address Space | Peered To |
|------|---------|---------------|-----------|
| vnet-hub-slz-swc | Centralized services | 10.0.0.0/23 | Spoke |
| vnet-spoke-prod-swc | Customer workloads | 10.0.2.0/23 | Hub |

### 3.2 Subnet Design

**Hub VNet Subnets:**

| Subnet | CIDR | Purpose | Special |
|--------|------|---------|---------|
| AzureFirewallSubnet | 10.0.0.0/26 | Firewall data plane | Required name |
| AzureFirewallManagementSubnet | 10.0.0.64/26 | Firewall management | Required name |
| snet-management | 10.0.0.128/26 | Jump boxes, management VMs | NSG attached |
| GatewaySubnet | 10.0.0.192/27 | VPN Gateway | Required name |
| AzureBastionSubnet | 10.0.0.224/27 | Azure Bastion | Required name |

**Spoke VNet Subnets:**

| Subnet | CIDR | Purpose | UDR |
|--------|------|---------|-----|
| snet-workload | 10.0.2.0/25 | General workloads | ✅ (firewall scenarios) |
| snet-data | 10.0.2.128/25 | Databases, storage | ✅ (firewall scenarios) |
| snet-app | 10.0.3.0/25 | Application tier | ✅ (firewall scenarios) |

### 3.3 Network Security

**NSG Rules (deny-by-default):**

- All inbound traffic denied by default
- VNet-to-VNet traffic allowed
- Azure Load Balancer probes allowed
- Outbound internet via NAT Gateway or Firewall

### 3.4 DNS Configuration

- Azure Private DNS Zone: `privatelink.azure.com`
- Auto-registration enabled for Hub VNet
- Linked to Spoke VNet for resolution

---

## 4. Storage

### 4.1 Storage Strategy

No storage accounts are pre-deployed. Customer workloads should use:

| Workload Type | Recommended Storage | Redundancy |
|---------------|--------------------|--------------| 
| VM Disks | Managed Disks (Standard SSD) | LRS |
| File Shares | Azure Files (Standard) | LRS |
| Blob Storage | Storage Account v2 | LRS |

### 4.2 Storage Policies

| Policy | Effect | Purpose |
|--------|--------|---------|
| HTTPS only | Deny | Encrypt data in transit |
| No public blob | Deny | Prevent data exposure |
| TLS 1.2+ | Deny | Modern encryption only |

---

## 5. Compute

### 5.1 Compute Strategy

No VMs are pre-deployed. Customer workloads are constrained by policy:

| Constraint | Allowed Values | Policy |
|------------|----------------|--------|
| VM Series | B, D, E only | smb-lz-compute-01 |
| Public IPs | None allowed | smb-lz-compute-02 |
| Disk Type | Managed only | smb-lz-compute-03 |

### 5.2 VM Access

- **Azure Bastion Developer**: Pre-deployed for secure VM access
- **No public IPs**: Enforced by policy on all VMs
- **NSG**: Management port access only from Bastion subnet

---

## 6. Identity & Access

### 6.1 Identity Strategy

- **Azure AD**: Primary identity provider
- **No local accounts**: SQL Azure AD-only auth enforced
- **RBAC**: Role-based access for partner management

### 6.2 Service Principals

| Principal | Purpose | Scope |
|-----------|---------|-------|
| Deployment SP | Bicep deployments | Subscription Owner |
| Backup SP | Auto-created by policy | Contributor (scoped) |

---

## 7. Security & Compliance

### 7.1 Security Controls

| Control Area | Implementation | Monitoring |
|--------------|----------------|------------|
| Network Isolation | NSG deny-all, Private endpoints | NSG flow logs |
| Data Protection | TLS 1.2+, HTTPS only | Azure Policy audit |
| Access Control | Azure AD, no public IPs | Sign-in logs |
| Threat Detection | Defender for Cloud (Free) | Security alerts |

### 7.2 Compliance Frameworks

| Framework | Coverage | Notes |
|-----------|----------|-------|
| Azure Security Baseline | 85% | Gaps in encryption at rest |
| GDPR | Partial | Data residency (swedencentral) |
| ISO 27001 | Audit only | No certification |

### 7.3 Policy Assignments

21 Azure Policies enforcing:
- Allowed VM SKUs (B/D/E series)
- No public IPs on VMs
- Managed disks required
- NSG on all subnets
- HTTPS-only storage
- Azure AD-only SQL auth
- Required tags (Environment, Owner)

---

## 8. Backup & Disaster Recovery

### 8.1 Backup Strategy

| Resource Type | Backup Method | RPO | Retention |
|---------------|---------------|-----|-----------|
| Azure VMs | Recovery Services Vault | 24 hours | 30 days daily, 12 weeks weekly |
| SQL Databases | PITR (customer-managed) | Varies | Customer-configured |
| Storage | Soft delete + versioning | N/A | Customer-configured |

### 8.2 Disaster Recovery

| Scenario | Strategy | RTO |
|----------|----------|-----|
| VM Failure | Rebuild from Bicep | 2-4 hours |
| Region Failure | Redeploy to secondary | 4-8 hours |
| Data Loss | Restore from backup | 1-2 hours |

> **Note**: This landing zone prioritizes cost over high availability. No zone redundancy
> or multi-region failover is included by design.

---

## 9. Management & Monitoring

### 9.1 Monitoring Strategy

| Component | Tool | Retention |
|-----------|------|-----------|
| Resource Logs | Log Analytics | 30 days |
| Metrics | Azure Monitor | 93 days |
| Alerts | Action Groups | N/A |
| Costs | Budget Alerts | Monthly |

### 9.2 Cost Management

| Control | Configuration |
|---------|---------------|
| Monthly Budget | $500 (configurable) |
| Alert Thresholds | 50%, 75%, 90%, 100% |
| Notifications | Owner email |

### 9.3 Operational Tooling

| Tool | Purpose |
|------|---------|
| Azure Bastion | Secure VM access |
| Azure Migrate | Server discovery |
| Log Analytics | Centralized logging |
| Defender for Cloud | Security posture |

---

## 10. Appendix

### A. Deployment Scenarios

| Scenario | Use Case | Monthly Cost |
|----------|----------|--------------|
| baseline | Cloud-only, testing | ~$48 |
| firewall | Egress filtering, compliance | ~$336 |
| vpn | Hybrid connectivity | ~$187 |
| full | Enterprise security | ~$476 |

### B. Azure Verified Modules Used

| Module | Version | Purpose |
|--------|---------|---------|
| avm/res/network/virtual-network | 0.7.2 | VNet creation |
| avm/res/network/network-security-group | 0.5.2 | NSG creation |
| avm/res/network/azure-firewall | 0.9.2 | Firewall deployment |
| avm/res/network/virtual-network-gateway | 0.10.1 | VPN Gateway |
| avm/res/recovery-services/vault | 0.11.1 | Backup vault |
| avm/res/operational-insights/workspace | 0.15.0 | Log Analytics |

### C. Related Documentation

- [Operations Runbook](./07-operations-runbook.md)
- [Backup & DR Plan](./07-backup-dr-plan.md)
- [Compliance Matrix](./07-compliance-matrix.md)
- [Resource Inventory](./07-resource-inventory.md)

---

_Design document generated by docs agent for SMB Landing Zone v0.3.0._
