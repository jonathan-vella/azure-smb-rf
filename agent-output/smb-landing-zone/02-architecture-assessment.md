# Step 2: Architecture Assessment - SMB Landing Zone

> Generated by architect agent | 2026-01-27 | Artifact v0.1

## Requirements Validation âœ…

| Category             | Status            | Details                                                           |
| -------------------- | ----------------- | ----------------------------------------------------------------- |
| NFRs (SLA, RTO, RPO) | âœ… Explicitly N/A | Cost priority over resilience; rebuild from Bicep if needed       |
| Compliance           | âœ… Defined        | 20 Azure Policies with built-in IDs; EU GDPR via region selection |
| Budget               | âœ… Defined        | $500/month hard cap with forecast + anomaly alerts                |
| Scale Requirements   | âœ… Defined        | Single subscription per SMB customer; 1000+ deployments expected  |

**Validation Result**: All critical requirements are defined or explicitly marked as N/A with justification. Proceeding with WAF assessment.

---

## Executive Summary

This architecture delivers a **cost-optimized, repeatable Azure landing zone** for VMware-to-Azure migrations targeting SMB customers. The design prioritizes **repeatability and cost efficiency** over high availability, explicitly accepting single-zone deployment risk in exchange for minimal monthly spend.

**Key architectural decisions:**

1. **Hub-spoke network** with pre-provisioned subnets for future expansion
2. **Azure Bastion Developer** (free tier) for secure VM access
3. **NAT Gateway** for deterministic outbound connectivity
4. **Azure Migrate** for VMware assessment (no ASR complexity)
5. **20 Azure Policies** enforcing security guardrails without manual intervention

### Recommended Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Subscription                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ rg-hub-swedencentral-001                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ Hub VNet (10.0.0.0/16)                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ AzureFirewallSubnet (/26) [reserved]            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ GatewaySubnet (/27) [reserved]                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ AzureBastionSubnet (/26) â†’ Bastion Developer    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  [Private DNS Zone] â† auto-registration                     â”‚   â”‚
â”‚  â”‚  [Azure Firewall Basic] â† OPTIONAL                          â”‚   â”‚
â”‚  â”‚  [VPN Gateway VpnGw1AZ] â† OPTIONAL                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚ VNet Peering (if FW/VPN deployed)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ rg-spoke-swedencentral-001                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ Spoke VNet (10.1.0.0/16)                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ WorkloadSubnet (/24) â†’ NSG + NAT Gateway        â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ rg-migrate       â”‚ â”‚ rg-monitor       â”‚ â”‚ rg-backup        â”‚    â”‚
â”‚  â”‚ Azure Migrate    â”‚ â”‚ Log Analytics    â”‚ â”‚ Recovery Vault   â”‚    â”‚
â”‚  â”‚ (VMware assess)  â”‚ â”‚ (500MB/day cap)  â”‚ â”‚ (VM backups)     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â”‚  [Cost Management Budget: $500/mo] [Defender for Cloud: Free]      â”‚
â”‚  [20 Azure Policies: Deny/Audit]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## WAF Pillar Assessment

### Overall Scores

| Pillar                    | Score | Confidence | Summary                                                                |
| ------------------------- | ----- | ---------- | ---------------------------------------------------------------------- |
| ðŸ”’ Security               | 8/10  | High       | Strong policy enforcement; no public IPs; Bastion-only access          |
| ðŸ”„ Reliability            | 4/10  | High       | Intentionally low - single-zone, no SLA targets, cost priority         |
| âš¡ Performance            | 6/10  | Medium     | Adequate for SMB workloads; B/D/E series restriction may limit options |
| ðŸ’° Cost Optimization      | 9/10  | High       | Excellent - free tiers, caps, budget alerts, minimal baseline          |
| ðŸ”§ Operational Excellence | 7/10  | High       | Good automation via Bicep; Log Analytics for visibility; policy-driven |

**Primary Pillar Optimized**: ðŸ’° Cost Optimization  
**Trade-offs Accepted**: Reliability (no zone redundancy, no SLA), Performance (VM SKU restrictions)

---

### ðŸ”’ Security Assessment (8/10)

**Strengths:**

- âœ… **No public IPs on VMs** - Policy-enforced (Deny effect)
- âœ… **Azure Bastion Developer** - Secure RDP/SSH without exposing management ports
- âœ… **20 Azure Policies** with built-in IDs - Consistent, auditable guardrails
- âœ… **Storage hardening** - HTTPS-only, TLS 1.2, no public blob access (all Deny)
- âœ… **NSG baseline** - Default deny inbound on all subnets
- âœ… **Azure AD-only SQL auth** - Future-proofed for SQL deployments (Audit)
- âœ… **Defender for Cloud Free tier** - Basic CSPM without cost overhead

**Gaps:**

- âš ï¸ **No Azure Firewall by default** - Optional; lateral movement not inspected
- âš ï¸ **No private endpoints** - Not required in baseline; traffic uses NAT Gateway
- âš ï¸ **No Key Vault** - Secrets management left to post-deployment configuration

**Recommendations:**

1. Deploy Azure Firewall Basic when inter-spoke or hybrid connectivity is enabled
2. Consider Private DNS Zone configuration for future PaaS service integration
3. Document post-deployment hardening steps for customer-specific requirements

### ðŸ”„ Reliability Assessment (4/10)

**Strengths:**

- âœ… **NAT Gateway Standard** - Highly available outbound with auto-scaling SNAT
- âœ… **Recovery Services Vault** - VM backup capability post-migration
- âœ… **Bicep IaC** - Reproducible deployment; rebuild entire environment if needed

**Gaps (Intentional per Requirements):**

- âš ï¸ **No zone redundancy** - Single-zone deployment to reduce cost
- âš ï¸ **No SLA target** - Explicitly N/A per requirements
- âš ï¸ **No RTO/RPO** - Rebuild from Bicep is the disaster recovery strategy
- âš ï¸ **Bastion Developer shared infrastructure** - Not dedicated; potential availability variance

**Recommendations:**

1. Document that RTO = time to redeploy Bicep (~15-30 minutes)
2. Ensure VM backup policies are configured immediately post-migration
3. Consider NAT Gateway StandardV2 (zone-redundant) for ~$0 additional cost if available

### âš¡ Performance Assessment (6/10)

**Strengths:**

- âœ… **NAT Gateway** - 50 Gbps throughput, auto-scaling SNAT ports
- âœ… **D/E series VMs allowed** - General purpose and memory-optimized available
- âœ… **Log Analytics daily cap** - Prevents runaway ingestion costs

**Gaps:**

- âš ï¸ **VM SKU policy restrictions** - M/N/L series blocked; may limit specialized workloads
- âš ï¸ **No performance testing baseline** - SMB workloads assumed to be modest
- âš ï¸ **Bastion Developer** - Single connection at a time; not for concurrent admin access

**Recommendations:**

1. Monitor SNAT port utilization on NAT Gateway for high-connection workloads
2. Consider adding Standard_F series to allowed SKUs if compute-intensive workloads emerge
3. Upgrade to Bastion Basic if concurrent admin sessions become a requirement

### ðŸ’° Cost Assessment (9/10)

| Service                 | SKU                    | Monthly Cost    | Notes                                |
| ----------------------- | ---------------------- | --------------- | ------------------------------------ |
| Azure Bastion           | Developer              | **$0**          | Free tier; shared infrastructure     |
| NAT Gateway             | Standard               | **~$32**        | $0.045/hr + $0.045/GB processed      |
| Log Analytics           | Per-GB (500MB/day cap) | **~$10**        | ~15GB/month @ $2.76/GB ingestion     |
| Recovery Services Vault | Standard               | **~$5**         | Base cost; backup storage extra      |
| Private DNS Zone        | Standard               | **~$0.50**      | $0.50/zone/month                     |
| Cost Management Budget  | N/A                    | **$0**          | Free feature                         |
| Defender for Cloud      | Free                   | **$0**          | CSPM basics only                     |
| Hub VNet + Spoke VNet   | N/A                    | **$0**          | VNets are free                       |
| NSGs (2x)               | N/A                    | **$0**          | NSGs are free                        |
| Azure Migrate Project   | N/A                    | **$0**          | Assessment is free                   |
| **Baseline Total**      |                        | **~$48/month**  | Without optional services            |
| Azure Firewall          | Basic                  | **+$288/month** | Optional                             |
| VPN Gateway             | VpnGw1AZ               | **+$140/month** | Optional; zone-redundant (~$0.19/hr) |
| **Maximum Total**       |                        | **~$476/month** | All optional services                |

**Cost Optimization Applied:**

- âœ… Bastion Developer (free) instead of Basic ($138/month savings)
- âœ… Log Analytics 500MB/day cap (prevents surprise ingestion costs)
- âœ… Defender Free tier (vs. Defender for Servers at ~$15/VM/month)
- âœ… No zone redundancy (avoids premium SKU requirements)
- âœ… NAT Gateway Standard vs. StandardV2 (comparable cost, zonal deployment)

### ðŸ”§ Operational Excellence Assessment (7/10)

**Strengths:**

- âœ… **Bicep IaC** - Version-controlled, repeatable deployments
- âœ… **Deploy-time parameters** - Configurable without template modification
- âœ… **Log Analytics** - Centralized logging with 30-day retention
- âœ… **Cost Management alerts** - Proactive budget and anomaly notifications
- âœ… **Azure Policy** - Automated compliance enforcement

**Gaps:**

- âš ï¸ **No Azure Monitor alerts** - Baseline doesn't include metric alerts
- âš ï¸ **No automation runbooks** - Manual intervention for operational tasks
- âš ï¸ **No tagging automation** - Relies on policy enforcement, not auto-remediation

**Recommendations:**

1. Add basic Azure Monitor alerts for NAT Gateway SNAT exhaustion
2. Document operational runbook for common tasks (add subnet, backup restore)
3. Consider Azure Policy remediation tasks for tag compliance

---

## Resource SKU Recommendations

| Service                 | Recommended SKU         | Configuration                   | Justification                                                                |
| ----------------------- | ----------------------- | ------------------------------- | ---------------------------------------------------------------------------- |
| Azure Bastion           | **Developer**           | Shared infrastructure           | Free tier; sufficient for SMB single-VM access                               |
| NAT Gateway             | **Standard**            | 1 public IP                     | Cost-effective outbound; upgrade to StandardV2 for zone-redundancy if needed |
| Log Analytics           | **Per-GB**              | 500MB/day cap, 30-day retention | Prevents cost overrun; sufficient for SMB visibility                         |
| Recovery Services Vault | **Standard**            | LRS redundancy                  | Adequate for non-critical backup; GRS available if needed                    |
| Azure Firewall          | **Basic** (optional)    | Default rules                   | Cheapest inspection tier; sufficient for SMB traffic patterns                |
| VPN Gateway             | **VpnGw1AZ** (optional) | 650 Mbps, max 30 tunnels        | Zone-redundant (~$140/mo); BGP support for hybrid connectivity               |
| Private DNS Zone        | **Standard**            | 1 zone, auto-registration       | Simple internal DNS; links to spoke VNet                                     |

---

## Architecture Decision Summary

| Decision           | Choice              | Rationale                                                                |
| ------------------ | ------------------- | ------------------------------------------------------------------------ |
| Region             | swedencentral       | EU GDPR-compliant, sustainable operations, cost-effective                |
| Bastion SKU        | Developer (free)    | Cost priority; single-connection limit acceptable for SMB                |
| NAT Gateway        | Standard (zonal)    | Cost-effective; zone-redundant StandardV2 available for upgrade          |
| Azure Firewall     | Optional (Basic)    | Not required unless hub services or inspection mandated                  |
| VPN Gateway        | Optional (VpnGw1AZ) | Zone-redundant (~$140/mo); BGP support; high availability                |
| Zone Redundancy    | No (except VPN)     | Explicit cost trade-off; VPN uses AZ SKU per Azure requirements          |
| Policy Enforcement | Deny > Audit        | Strong guardrails for compute, storage, network, tagging                 |
| Backup Strategy    | Post-migration      | Recovery Services Vault deployed; policies configured after VM migration |

---

## Implementation Handoff

### Ready for bicep-plan

The architecture is approved for implementation with the following key parameters:

```yaml
region: swedencentral
environment: prod
budget: $500/month (estimated: ~$48-$476 depending on options)

resources:
  required:
    - Hub VNet with AzureFirewallSubnet, GatewaySubnet, AzureBastionSubnet
    - Spoke VNet with workload subnet
    - Azure Bastion Developer
    - NAT Gateway Standard
    - Private DNS Zone
    - Log Analytics Workspace (500MB/day cap)
    - Recovery Services Vault
    - Azure Migrate Project
    - Cost Management Budget ($500/mo)
    - Defender for Cloud (Free tier)
    - NSGs (hub + spoke)
  optional:
    - Azure Firewall Basic
    - VPN Gateway VpnGw1AZ
    - VNet Peering (if Firewall or VPN deployed)

security:
  - 20 Azure Policies with built-in IDs
  - Mandatory tags: Environment, Owner
  - No public IPs on VMs (Deny)
  - Storage: HTTPS-only, TLS 1.2, no public access

monitoring:
  - Log Analytics (30-day retention)
  - Cost Management budget alerts
  - Defender for Cloud CSPM
```

---

## Approval Gate

> **ðŸ—ï¸ Architecture Assessment Complete**
>
> | Pillar      | Score |
> | ----------- | ----- |
> | Security    | 8/10  |
> | Reliability | 4/10  |
> | Performance | 6/10  |
> | Cost        | 9/10  |
> | Operations  | 7/10  |
>
> **Estimated Monthly Cost**: ~$48 (baseline) to ~$476 (all options)
>
> **Confidence Level**: High (requirements well-defined; pricing from Azure documentation)
>
> Reply **"approve"** to proceed to bicep-plan, or provide feedback for revisions.
>
> Reply **"save costs"** to generate detailed cost estimate document.

---

_Assessment performed using Azure Well-Architected Framework. Pricing data from Azure documentation and Azure Pricing MCP (2026-01-27)._
