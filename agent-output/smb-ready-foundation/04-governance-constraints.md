# Governance Constraints - SMB Ready Foundation

> Generated by bicep-plan agent | 2026-01-27 | Artifact v0.1

This document captures the governance constraints and Azure Policy requirements
that are deployed as part of the Bicep implementation.

## Azure Policy Compliance

**Governance Source**: Project-defined (policies deployed by this project)

These policies will be assigned at subscription scope as part of the Bicep deployment.
Policy cleanup script: `scripts/Remove-SmbReadyFoundationPolicies.ps1`

| Category       | Constraint                  | Implementation                         | Source          |
| -------------- | --------------------------- | -------------------------------------- | --------------- |
| Naming         | Azure naming conventions    | Enforced via Bicep variables           | Project-defined |
| Tagging        | Environment, Owner required | Azure Policy Deny                      | Project-defined |
| Locations      | swedencentral, gwc, global  | Azure Policy Deny                      | Project-defined |
| VM SKUs        | B, D/E v5/v6 series only    | Azure Policy Deny                      | Project-defined |
| Storage        | HTTPS, TLS 1.2, no public   | Azure Policy Deny                      | Project-defined |
| Data Residency | EU regions (swedencentral)  | Azure Policy Deny + region restriction | Project-defined |

## Required Tags

All resources must include the following tags:

```bicep
tags: {
  Environment: environment  // dev, staging, prod
  Project: 'smb-ready-foundation'
  ManagedBy: 'Bicep'
  Owner: owner              // Email or team name
}
```

**Policy Enforcement**:

| Tag         | Policy Assignment | Effect |
| ----------- | ----------------- | ------ |
| Environment | smb-tagging-01 | Deny   |
| Owner       | smb-tagging-02 | Deny   |

## Security Policies

| Policy        | Requirement                    | Built-in ID                          | Effect |
| ------------- | ------------------------------ | ------------------------------------ | ------ |
| HTTPS Only    | Storage accounts require HTTPS | 404c3081-a854-4457-ae30-26a93ef643f9 | Deny   |
| TLS Version   | Minimum TLS 1.2 for storage    | fe83a0eb-a853-422d-aac2-1bffd182c5d0 | Deny   |
| Public Access | No public blob access          | 4fa4b6c0-31ca-4c0d-b10d-24b96f62a751 | Deny   |
| Public IPs    | No public IPs on NICs          | 83a86a26-fd1f-447c-b59d-e51f44264114 | Deny   |
| IP Forwarding | Disabled on VMs                | 88c0b9da-ce96-4b03-9635-f29a937e2900 | Deny   |
| SQL Auth      | Azure AD-only authentication   | abda6d70-9778-44e7-84a8-06f9e9f5b64b | Audit  |
| SQL Public    | No public network access       | 1b8ca024-1d5c-4dec-8995-b1a932b41780 | Audit  |

## Cost Policies

| Policy            | Constraint                        | Implementation                                 |
| ----------------- | --------------------------------- | ---------------------------------------------- |
| Budget            | $500/month hard cap               | Cost Management Budget with 80% forecast alert |
| VM SKUs           | B, D/E v5/v6 series only          | Azure Policy Deny (cccc23c7-...)               |
| Regions           | swedencentral, germanywestcentral | Azure Policy Deny - prevents expensive regions |
| Reserved Capacity | Not enforced                      | Eligible for reservations but not required     |

**Allowed VM SKUs**:

```json
[
  "Standard_B*",
  "Standard_D*v5",
  "Standard_D*s_v5",
  "Standard_D*v6",
  "Standard_D*s_v6",
  "Standard_E*v5",
  "Standard_E*s_v5",
  "Standard_E*v6",
  "Standard_E*s_v6"
]
```

## Network Policies

| Policy            | Constraint                          | Effect                     |
| ----------------- | ----------------------------------- | -------------------------- |
| NSG on Subnets    | All subnets must have NSG           | AuditIfNotExists           |
| Management Ports  | Ports 22, 3389 closed from internet | AuditIfNotExists           |
| NSG Rules         | All ports restricted in NSG rules   | AuditIfNotExists           |
| Private Endpoints | Not enforced                        | Optional for PaaS services |
| VNet Integration  | Hub-spoke peering when Firewall/VPN | Bicep conditional          |
| Public Endpoints  | Blocked for VMs via NIC policy      | Deny                       |

## Policy Assignment Summary

### Compute Guardrails (4 policies)

| #   | Assignment Name   | Policy                | Effect |
| --- | ----------------- | --------------------- | ------ |
| 1   | smb-compute-01 | Allowed VM SKUs       | Deny   |
| 2   | smb-compute-02 | No public IPs on NICs | Deny   |
| 3   | smb-compute-03 | Audit managed disks   | Audit  |
| 4   | smb-compute-04 | Audit ARM VMs         | Audit  |

### Network Guardrails (4 policies)

| #   | Assignment Name   | Policy                 | Effect           |
| --- | ----------------- | ---------------------- | ---------------- |
| 5   | smb-network-01 | NSG on subnets         | AuditIfNotExists |
| 6   | smb-network-02 | Close management ports | AuditIfNotExists |
| 7   | smb-network-03 | Restrict NSG ports     | AuditIfNotExists |
| 8   | smb-network-04 | Disable IP forwarding  | Deny             |

### Storage Guardrails (5 policies)

| #   | Assignment Name   | Policy                  | Effect |
| --- | ----------------- | ----------------------- | ------ |
| 9   | smb-storage-01 | HTTPS only              | Deny   |
| 10  | smb-storage-02 | No public blob access   | Deny   |
| 11  | smb-storage-03 | TLS 1.2 minimum         | Deny   |
| 12  | smb-storage-04 | Restrict network access | Audit  |
| 13  | smb-storage-05 | ARM migration           | Audit  |

### Identity & Access (2 policies)

| #   | Assignment Name    | Policy               | Effect |
| --- | ------------------ | -------------------- | ------ |
| 14  | smb-identity-01 | SQL Azure AD-only    | Audit  |
| 15  | smb-identity-02 | SQL no public access | Audit  |

### Tagging & Governance (3 policies)

| #   | Assignment Name      | Policy                  | Effect |
| --- | -------------------- | ----------------------- | ------ |
| 16  | smb-tagging-01    | Require Environment tag | Deny   |
| 17  | smb-tagging-02    | Require Owner tag       | Deny   |
| 18  | smb-governance-01 | Allowed locations       | Deny   |

### Monitoring & Backup (2 policies)

| #   | Assignment Name      | Policy              | Effect           |
| --- | -------------------- | ------------------- | ---------------- |
| 19  | smb-backup-01     | VM backup required  | AuditIfNotExists |
| 20  | smb-monitoring-01 | Diagnostic settings | AuditIfNotExists |

---

_Governance constraints extracted from 01-requirements.md. Policies deployed via policy-assignments.bicep._
